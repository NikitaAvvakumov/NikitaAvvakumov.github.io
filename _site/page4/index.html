<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
    
      Gemfile &middot; I codes and I blogs
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/styles.css">

  <!-- Icons -->
  <link rel="apple-icon-precomposed" sizes="144x144" href="/public/apple-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="Gemfile" href="/atom.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="/" title="Home">Gemfile</a>
          &middot;
          <small>I codes and I blogs</small>
        </h3>
      </header>

      <main>
        <div class="posts">
  
    <article class="post">
      <h1 class="post-title">
        <a href="/2014/04/04/block-delimiters-not-just-a-matter-of-style/">
          do..end vs {}: Not just a matter of style!
        </a>
      </h1>

      <time datetime="2014-04-04T11:54:40+03:00" class="post-date">04 Apr 2014</time>

      <p>“Use curly braces for single-line blocks and <code>do..end</code> for multi-lines blocks.” After seeing various permutations of that statement dozens of times, one can come to believe that the difference between the two is purely stylistic and that there is no practical reason to opt for one vs. the other. Most of the time, that is, indeed, true. Until that one-time-in-a-thousand when it’s not.</p>

<p>The trouble with <code>do..end</code> vs. <code>{}</code> can show up thanks to (a) Ruby’s laid-back attitude towards syntax, and (b) the fact that the two kinds of block delimiters do not behave 100% identically.</p>

<p>The syntax slackness in question is the optional usage of parentheses around method parameters. For instance, the following line pairs of code are identical:</p>

<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">FactoryGirl.create(:user) # is the same as</span>
<span class="x">FactoryGirl.create :user</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span><span class="p">(</span><span class="s1">&#39;Sign in&#39;</span><span class="p">,</span> <span class="n">signin_path</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"> # is the same as</span>
<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Sign in&#39;</span><span class="p">,</span> <span class="n">signin_path</span> <span class="cp">%&gt;</span><span class="x"></span></code></pre></div>

<p>The parentheses can be safely omitted from method calls in the vast majority of cases. That is, unless a block is involved, which brings us to (b).
The not-so-subtle difference between <code>do..end</code> and <code>{}</code> is their order of precedence - the curly braces rank higher on that score than <code>do..end</code>. This means that in a parentheses-less method call, the curly braces will bind the block to the preceding parameter, while <code>do..end</code> will bind it to the method.</p>

<p>Example:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails console
2.1.0 :001 &gt; puts <span class="o">[</span>1, 2, 3<span class="o">]</span>.map <span class="o">{</span> <span class="p">|</span>x<span class="p">|</span> x * <span class="m">2</span> <span class="o">}</span>
2
4
6
2.1.0 :002 &gt; puts <span class="o">[</span>1, 2, 3<span class="o">]</span>.map <span class="k">do</span> <span class="p">|</span>x<span class="p">|</span> x * 2<span class="p">;</span> end
<span class="c">#&lt;Enumerator:hex_code&gt;</span></code></pre></div>

<p>The first command was equivalent to</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">puts<span class="o">([</span>1, 2, 3<span class="o">]</span>.map <span class="o">{</span> <span class="p">|</span>x<span class="p">|</span> x * <span class="m">2</span> <span class="o">})</span></code></pre></div>

<p>while the second was interpreted as</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">puts<span class="o">([</span>1, 2, 3<span class="o">]</span>.map<span class="o">)</span> <span class="o">{</span> <span class="p">|</span>x<span class="p">|</span> x * <span class="m">2</span> <span class="o">}</span></code></pre></div>

<p>In the first case, the block was passed to <code>.map</code>, which evaluated it and then gave the result back to <code>puts</code>. In the second case, the block was passed to <code>puts</code>, which ignored it and only reported that calling <code>.map</code> on an array yields an <code>Enumerator</code> object.</p>



      
      
      

    </article>
  
    <article class="post">
      <h1 class="post-title">
        <a href="/2014/03/26/try/">
          .try
        </a>
      </h1>

      <time datetime="2014-03-26T07:44:43+02:00" class="post-date">26 Mar 2014</time>

      <p>This Ruby method returns nil rather than raising an exception when called on a non-existent object.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails console
2.1.0 :001 &gt; nil.admin?
NoMethodError: undefined method <span class="s1">&#39;admin?&#39;</span> <span class="k">for</span> nil:NilClass
... stack trace ...
2.1.0 :002 &gt; nil.try<span class="o">(</span>:admin<span class="o">)</span>
 <span class="o">=</span>&gt; nil</code></pre></div>

<p>Here’s a practical example: Is the currently signed in user an admin? If so, he should see site admin links, otherwise they should be hidden:</p>

<p><strong>any_view_file.html.erb:</strong></p>

<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">admin?</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  Show links</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span></code></pre></div>

<p>The above code breaks when the page is viewed by a non-signed-in visitor and <code>current_user</code> is not set (i.e. is nil).</p>

<p>The <code>if</code> statement can be augmented to include two tests:</p>

<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">current_user</span> <span class="o">&amp;&amp;</span> <span class="n">current_user</span><span class="o">.</span><span class="n">admin?</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  Show links</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span></code></pre></div>

<p>Or the <code>try</code> method can be used to clean up the code:</p>

<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">try</span><span class="p">(</span><span class="ss">:admin</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  Show links</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span></code></pre></div>

<p>The <code>if</code> statement will return <code>true</code> if the currently signed in user is an admin, <code>false</code> if he is not, and <code>nil</code> if there is no signed in user. Since <code>nil</code> is falsey, the admin links remain nicely hidden.</p>

<p>(This approach merely cleans up the layout for unauthorized users. It should not be relied on to actually prevent unauthorized access to controller actions.)</p>



      
      
      

    </article>
  
    <article class="post">
      <h1 class="post-title">
        <a href="/2014/03/13/nuking-all-changes-with-git/">
          Nuking all changes with Git
        </a>
      </h1>

      <time datetime="2014-03-13T15:19:44+02:00" class="post-date">13 Mar 2014</time>

      <p>After looking it up twice in one (less than productive) day…</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git reset --hard <span class="c"># delete all changes from tracked files</span>
<span class="nv">$ </span>git clean -f -d <span class="c"># remove untracked files and directories</span></code></pre></div>

<p><em>(Warning: This is destructive! Code will be irreversibly lost.)</em></p>

<p>An alternative to doing the above would be:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git add .
<span class="nv">$ </span>git reset --hard</code></pre></div>

<p>And if things aren’t a complete disaster that deserves to be annihilated - for example, perhaps they can serve as a stern reminder in the future - they can be saved prior to destruction with</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git diff &gt; ~/lessons_learned/rails_mess_1.diff</code></pre></div>



      
      
      

    </article>
  
    <article class="post">
      <h1 class="post-title">
        <a href="/2014/03/13/enjoy-your-day-of-the-week/">
          Enjoy your day-of-the-week :)
        </a>
      </h1>

      <time datetime="2014-03-13T10:27:21+02:00" class="post-date">13 Mar 2014</time>

      <p>Simple:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails console
2.1.0 :001 &gt; Time.now.wday
  <span class="o">=</span>&gt; <span class="m">4</span>   <span class="c">#Thursday</span>
2.1.0 :002 &gt; Date::DAYNAMES
  <span class="o">=</span>&gt; <span class="o">[</span><span class="s2">&quot;Sunday&quot;</span>, <span class="s2">&quot;Monday&quot;</span>, <span class="s2">&quot;Tuesday&quot;</span>, <span class="s2">&quot;Wednesday&quot;</span>, <span class="s2">&quot;Thursday&quot;</span>, <span class="s2">&quot;Friday&quot;</span>, <span class="s2">&quot;Saturday&quot;</span><span class="o">]</span>
2.1.0 :003 &gt; <span class="s2">&quot;Enjoy your #{Date::DAYNAMES[Time.now.wday]}.&quot;</span>
  <span class="o">=</span>&gt; <span class="s2">&quot;Enjoy your Thursday.&quot;</span></code></pre></div>



      
      
      

    </article>
  
</div>

<div class="pagination">
  
    <span class="pagination-item older">Older</span>
  
  
    <a class="pagination-item newer" href="/page3">Newer</a>
  
</div>

      </main>

      <footer class="footer">
        <small>
          &copy; <time datetime="2015-06-27T13:22:17+03:00">2015</time> Nikita Avvakumov.
          Happily made with <a href="http://demo.getpoole.com/">Poole</a>.
        </small>
      </footer>
    </div>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-64562360-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>
