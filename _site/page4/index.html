<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
    
      Gemfile &middot; I codes and I blogs
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/styles.css">

  <!-- Icons -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="apple-touch-icon" sizes="57x57" href="/public/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/public/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/public/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/public/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/public/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/public/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/public/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/public/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/public/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/public/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/public/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/public/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/public/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/public/manifest.json">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/public/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="Gemfile" href="/atom.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="/" title="Home">Gemfile</a>
          &middot;
          <small>I codes and I blogs</small>
        </h3>
      </header>

      <main>
        <div class="posts">
  
    <article class="post">
      <h1 class="post-title">
        <a href="/2014/04/27/paperclip-attachments-in-factories/">
          Paperclip attachments in RSpec factories
        </a>
      </h1>

      <time datetime="2014-04-27T12:11:46+03:00" class="post-date">27 Apr 2014</time>

      <p>Assuming one has a model whose attachments are handled by Paperclip, i.e.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails generate paperclip user photo</code></pre></div>

<p><strong>app/models/user.rb:</strong></p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_attached_file</span> <span class="ss">:photo</span>
<span class="k">end</span></code></pre></div>

<p>then to generate a test model with FactoryGirl, including the attachment:</p>

<p><strong>spec/factories/user_factory.rb:</strong></p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="kp">include</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">TestProcess</span>
<span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
    <span class="nb">name</span> <span class="s1">&#39;Sample User&#39;</span>
    <span class="o">.</span><span class="n">.</span><span class="o">.</span>
    <span class="n">photo</span> <span class="p">{</span> <span class="n">fixture_file_upload</span><span class="p">(</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;spec/fixtures/test_img.png&#39;</span><span class="p">),</span> <span class="s1">&#39;image/png&#39;</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Various manipulations of the attached image through the web interface can then be tested with RSpec and Capybara.</p>



      
      
      

    </article>
  
    <article class="post">
      <h1 class="post-title">
        <a href="/2014/04/27/testing-images-with-rspec/">
          Testing images with RSpec
        </a>
      </h1>

      <time datetime="2014-04-27T11:58:38+03:00" class="post-date">27 Apr 2014</time>

      <p>To test whether the right image is displayed on a page:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_css</span><span class="p">(</span><span class="s2">&quot;img[src*=&#39;image_name.png&#39;]&quot;</span><span class="p">)</span></code></pre></div>

<p>i.e. “Expect page to have an <code>&lt;img&gt;</code> tag whose <code>src</code> attribute contains the name of the required image.”</p>



      
      
      

    </article>
  
    <article class="post">
      <h1 class="post-title">
        <a href="/2014/04/17/delegate-your-model-methods/">
          Learn to delegate (your model methods)
        </a>
      </h1>

      <time datetime="2014-04-17T16:10:42+03:00" class="post-date">17 Apr 2014</time>

      <p><code>delegate</code> is neat trick that allows one to write cleaner, neater code. Particularly when dealing with ActiveRecord associations, <code>delegate</code> makes it possible to “outsource” a method to an associated object.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Book</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1"># has attribute &#39;author&#39;</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Chapter</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:book</span>
  <span class="n">delegate</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="ss">:book</span>
<span class="k">end</span></code></pre></div>

<p>Without <code>delegate</code>, when dealing with a <code>Chapter</code> object, you’d need to access the book’s author via <code>chapter.book.author</code>. With delegation, this can be neatly shortened to <code>chapter.author</code>, with the <code>.author</code> getting handed off to the associated <code>Book</code> object.</p>

<p>An object can delegate multiple methods to its association, as shown in the example below. Another handy option is to use <em>prefixes</em> with <code>delegate</code>. For instance, using the same approach as above to refer to the book’s title would create <code>chapter.title</code>, which is confusing. With prefixes, however:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Chapter</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:book</span>
  <span class="n">delegate</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="ss">:book</span><span class="p">,</span> <span class="ss">prefix</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="n">chapter</span><span class="o">.</span><span class="n">book_title</span>   <span class="c1"># returns book&#39;s title</span>
<span class="n">chapter</span><span class="o">.</span><span class="n">book_author</span>  <span class="c1"># returns book&#39;s author</span></code></pre></div>

<p>(Of course, if chapters had their own titles, the above code would make them inaccessible, but that’s what you get with contrived examples. See <a href="http://pivotallabs.com/rails-delegates-are-even-more-useful-than-i-knew/">this post</a> on the Pivotal Labs’ blog for a solution.)</p>

<p>One final tidbit to touch upon is that <code>delegate</code> is not limited to deliberately created methods and attributes but extends equally well to those created behind the scenes by the association:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Quote</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:chapter</span>
  <span class="n">delegate</span> <span class="ss">:book</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="ss">:chapter</span>
<span class="k">end</span>

<span class="n">quote</span><span class="o">.</span><span class="n">book</span>  <span class="c1"># returns the book object associated with the chapter to which the quote belongs</span></code></pre></div>

<p>For more on <code>delegate</code>, including custom prefixes and how to handle NoMethodErrors, see the <a href="http://apidock.com/rails/Module/delegate">API Docs</a>.</p>



      
      
      

    </article>
  
    <article class="post">
      <h1 class="post-title">
        <a href="/2014/04/10/is-it-changed/">
          Is it changed?
        </a>
      </h1>

      <time datetime="2014-04-10T09:35:58+03:00" class="post-date">10 Apr 2014</time>

      <p>Rails has some useful methods to check whether an object has changed since first being loaded into memory. Here are some examples:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">2.1.0 :001 &gt; <span class="nv">user</span> <span class="o">=</span> User.find<span class="o">(</span>1<span class="o">)</span>
 <span class="o">=</span>&gt; <span class="c">#&lt;User id: 1, name: &quot;Roderick&quot;, email: &quot;rod@example.com&quot;, created_at: ..., updated_at: ...&gt;</span>
2.1.0 :002 &gt; user.name <span class="o">=</span> <span class="s1">&#39;Jimmy&#39;</span>
 <span class="o">=</span>&gt; <span class="s2">&quot;Jimmy&quot;</span>
2.1.0 :003 &gt; user.changed?
 <span class="o">=</span>&gt; <span class="nb">true</span>
2.1.0 :004 &gt; user.changed
 <span class="o">=</span>&gt; <span class="o">[</span><span class="s2">&quot;name&quot;</span><span class="o">]</span>
2.1.0 :005 &gt; user.changes
 <span class="o">=</span>&gt; <span class="o">{</span><span class="s2">&quot;name&quot;</span><span class="o">=</span>&gt;<span class="o">[</span><span class="s2">&quot;Roderick&quot;</span>, <span class="s2">&quot;Jimmy&quot;</span><span class="o">]}</span>
2.1.0 :006 &gt; user.name_changed?
 <span class="o">=</span>&gt; <span class="nb">true</span>
2.1.0 :007 &gt; user.email_changed?
 <span class="o">=</span>&gt; <span class="nb">false</span>
2.1.0 :008 &gt; user.name_was
 <span class="o">=</span>&gt; <span class="s2">&quot;Roderick&quot;</span>
2.1.0 :009 &gt; user.save
 <span class="o">=</span>&gt; <span class="nb">true</span>
2.1.0 :010 &gt; user.changed?
 <span class="o">=</span>&gt; <span class="nb">false</span></code></pre></div>

<p>More info here: <a href="http://api.rubyonrails.org/classes/ActiveModel/Dirty.html">ActiveModel::Dirty</a>.</p>



      
      
      

    </article>
  
    <article class="post">
      <h1 class="post-title">
        <a href="/2014/04/04/block-delimiters-not-just-a-matter-of-style/">
          do..end vs {}: Not just a matter of style!
        </a>
      </h1>

      <time datetime="2014-04-04T11:54:40+03:00" class="post-date">04 Apr 2014</time>

      <p>“Use curly braces for single-line blocks and <code>do..end</code> for multi-lines blocks.” After seeing various permutations of that statement dozens of times, one can come to believe that the difference between the two is purely stylistic and that there is no practical reason to opt for one vs. the other. Most of the time, that is, indeed, true. Until that one-time-in-a-thousand when it’s not.</p>

<p>The trouble with <code>do..end</code> vs. <code>{}</code> can show up thanks to (a) Ruby’s laid-back attitude towards syntax, and (b) the fact that the two kinds of block delimiters do not behave 100% identically.</p>

<p>The syntax slackness in question is the optional usage of parentheses around method parameters. For instance, the following line pairs of code are identical:</p>

<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">FactoryGirl.create(:user) # is the same as</span>
<span class="x">FactoryGirl.create :user</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span><span class="p">(</span><span class="s1">&#39;Sign in&#39;</span><span class="p">,</span> <span class="n">signin_path</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"> # is the same as</span>
<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Sign in&#39;</span><span class="p">,</span> <span class="n">signin_path</span> <span class="cp">%&gt;</span><span class="x"></span></code></pre></div>

<p>The parentheses can be safely omitted from method calls in the vast majority of cases. That is, unless a block is involved, which brings us to (b).
The not-so-subtle difference between <code>do..end</code> and <code>{}</code> is their order of precedence - the curly braces rank higher on that score than <code>do..end</code>. This means that in a parentheses-less method call, the curly braces will bind the block to the preceding parameter, while <code>do..end</code> will bind it to the method.</p>

<p>Example:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rails console
2.1.0 :001 &gt; puts <span class="o">[</span>1, 2, 3<span class="o">]</span>.map <span class="o">{</span> <span class="p">|</span>x<span class="p">|</span> x * <span class="m">2</span> <span class="o">}</span>
2
4
6
2.1.0 :002 &gt; puts <span class="o">[</span>1, 2, 3<span class="o">]</span>.map <span class="k">do</span> <span class="p">|</span>x<span class="p">|</span> x * 2<span class="p">;</span> end
<span class="c">#&lt;Enumerator:hex_code&gt;</span></code></pre></div>

<p>The first command was equivalent to</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">puts<span class="o">([</span>1, 2, 3<span class="o">]</span>.map <span class="o">{</span> <span class="p">|</span>x<span class="p">|</span> x * <span class="m">2</span> <span class="o">})</span></code></pre></div>

<p>while the second was interpreted as</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">puts<span class="o">([</span>1, 2, 3<span class="o">]</span>.map<span class="o">)</span> <span class="o">{</span> <span class="p">|</span>x<span class="p">|</span> x * <span class="m">2</span> <span class="o">}</span></code></pre></div>

<p>In the first case, the block was passed to <code>.map</code>, which evaluated it and then gave the result back to <code>puts</code>. In the second case, the block was passed to <code>puts</code>, which ignored it and only reported that calling <code>.map</code> on an array yields an <code>Enumerator</code> object.</p>



      
      
      

    </article>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page5">Older</a>
  
  
    <a class="pagination-item newer" href="/page3">Newer</a>
  
</div>

      </main>

      <footer class="footer">
        <small>
          &copy; <time datetime="2016-02-09T00:17:56+02:00">2016</time> Nikita Avvakumov.
          Happily made with <a href="http://demo.getpoole.com/">Poole</a>.
        </small>
      </footer>
    </div>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-64562360-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>
